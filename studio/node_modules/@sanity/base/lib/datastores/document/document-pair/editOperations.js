"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.editOperations = void 0;

var _rxjs = require("rxjs");

var _operators = require("rxjs/operators");

var _createMemoizer = require("../utils/createMemoizer");

var _operationArgs = require("./operationArgs");

var _operationEvents = require("./operationEvents");

var _helpers = require("./operations/helpers");

/* eslint-disable @typescript-eslint/no-use-before-define */
var editOperations = (0, _createMemoizer.memoize)((idPair, typeName) => {
  // To makes sure we connect the stream that actually performs the operations
  var operationResults$ = (0, _operationEvents.operationEvents)(idPair, typeName).pipe((0, _operators.mergeMapTo)(_rxjs.EMPTY));
  return (0, _rxjs.concat)((0, _rxjs.of)(_helpers.GUARDED), (0, _rxjs.merge)(operationResults$, (0, _operationArgs.operationArgs)(idPair, typeName).pipe((0, _operators.map)(_helpers.createOperationsAPI)))).pipe((0, _operators.publishReplay)(1), (0, _operators.refCount)());
}, (idPair, typeName) => idPair.publishedId + typeName);
exports.editOperations = editOperations;